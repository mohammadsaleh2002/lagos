{% extends "base.html" %}
{% block title %}{{ t('articles') }} - {{ project.name }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 animate-in">
    <div>
        <h2>{{ project.name }} - {{ t('articles') }}</h2>
        <div class="d-flex gap-2 mt-1">
            <span class="badge bg-secondary">{{ stats.articles_total }} {{ t('total') }}</span>
            <span class="badge bg-success">{{ stats.articles_published }} {{ t('published') }}</span>
            <span class="badge bg-warning">{{ stats.articles_unpublished }} {{ t('in_queue') }}</span>
        </div>
    </div>
    <div>
        <form method="POST" action="{{ url_for('content.generate', project_id=project._id) }}" class="d-inline">
            <div class="btn-group" role="group">
                <button type="submit" name="action" value="keywords" class="btn btn-outline-secondary">
                    <i class="bi bi-key"></i> {{ t('generate_keywords') }}
                </button>
                <button type="submit" name="action" value="titles" class="btn btn-outline-secondary">
                    <i class="bi bi-card-heading"></i> {{ t('generate_titles') }}
                </button>
                <button type="submit" name="action" value="article" class="btn btn-outline-primary">
                    <i class="bi bi-file-earmark-plus"></i> {{ t('generate_article') }}
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Filter -->
<ul class="nav nav-tabs mb-3 animate-in animate-in-delay-1">
    <li class="nav-item">
        <a class="nav-link {{ 'active' if filter_type == 'all' }}"
           href="{{ url_for('content.articles', project_id=project._id, filter='all') }}">{{ t('all') }}</a>
    </li>
    <li class="nav-item">
        <a class="nav-link {{ 'active' if filter_type == 'unpublished' }}"
           href="{{ url_for('content.articles', project_id=project._id, filter='unpublished') }}">{{ t('unpublished') }}</a>
    </li>
    <li class="nav-item">
        <a class="nav-link {{ 'active' if filter_type == 'published' }}"
           href="{{ url_for('content.articles', project_id=project._id, filter='published') }}">{{ t('published') }}</a>
    </li>
</ul>

{% if articles %}
<div class="table-responsive animate-in animate-in-delay-2">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>{{ t('title') }}</th>
                <th>{{ t('tag') }}</th>
                <th>{{ t('chapters') }}</th>
                <th>{{ t('status') }}</th>
                <th>{{ t('created_at') }}</th>
                <th>{{ t('actions') }}</th>
            </tr>
        </thead>
        <tbody>
        {% for a in articles %}
        <tr>
            <td>
                <a href="{{ url_for('content.article_detail', project_id=project._id, article_id=a._id) }}" style="color:var(--accent);text-decoration:none;">
                    {{ a.article_title[:60] }}{% if a.article_title|length > 60 %}...{% endif %}
                </a>
            </td>
            <td><span class="badge bg-secondary">{{ a.tag }}</span></td>
            <td>{{ a.chapters|length }}</td>
            <td>
                {% if a.is_published %}
                <span class="badge bg-success">{{ t('published') }}</span>
                {% else %}
                <span class="badge bg-warning">{{ t('pending') }}</span>
                {% endif %}
            </td>
            <td>{{ a.created_at.strftime('%Y-%m-%d %H:%M') if a.created_at else '-' }}</td>
            <td>
                {% if not a.is_published %}
                <form method="POST" action="{{ url_for('publishing.publish', project_id=project._id) }}" class="d-inline">
                    <input type="hidden" name="article_id" value="{{ a._id }}">
                    <button class="btn btn-sm btn-outline-success">
                        <i class="bi bi-upload"></i> {{ t('publish') }}
                    </button>
                </form>
                {% elif a.wp_post_url %}
                <a href="{{ a.wp_post_url }}" target="_blank" class="btn btn-sm btn-outline-info">
                    <i class="bi bi-box-arrow-up-right"></i> {{ t('view') }}
                </a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state animate-in">
    <div class="empty-icon"><i class="bi bi-file-earmark-text"></i></div>
    <p>{{ t('no_articles_yet') }}</p>
</div>
{% endif %}

<!-- Keywords link -->
<div class="mt-3 animate-in animate-in-delay-3">
    <a href="{{ url_for('content.keywords', project_id=project._id) }}" class="btn btn-outline-secondary">
        <i class="bi bi-tags"></i> {{ t('view_keywords_titles') }}
    </a>
</div>
{% endblock %}
