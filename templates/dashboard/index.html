{% extends "base.html" %}
{% block title %}{{ t('dashboard') }}{% endblock %}
{% block content %}
<h2 class="mb-4">{{ t('dashboard') }}</h2>

<!-- Summary Stat Cards -->
<div class="row mb-4">
    <div class="col-md-3 animate-in animate-in-delay-1">
        <div class="card stat-card stat-primary">
            <div class="card-body d-flex align-items-center gap-3">
                <div class="stat-icon"><i class="bi bi-folder2"></i></div>
                <div>
                    <div class="stat-value" data-count="{{ project_stats|length }}">0</div>
                    <div class="stat-label">{{ t('projects') }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 animate-in animate-in-delay-2">
        <div class="card stat-card stat-success">
            <div class="card-body d-flex align-items-center gap-3">
                <div class="stat-icon"><i class="bi bi-key"></i></div>
                <div>
                    <div class="stat-value" data-count="{{ active_keys }}">0</div>
                    <div class="stat-label">{{ t('api_keys') }} <span class="text-muted">/ {{ api_keys_count }}</span></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 animate-in animate-in-delay-3">
        <div class="card stat-card stat-info">
            <div class="card-body d-flex align-items-center gap-3">
                <div class="stat-icon"><i class="bi bi-file-earmark-text"></i></div>
                <div>
                    <div class="stat-value" data-count="{{ project_stats|sum(attribute='articles_total') }}">0</div>
                    <div class="stat-label">{{ t('total_articles') }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 animate-in animate-in-delay-4">
        <div class="card stat-card stat-warning">
            <div class="card-body d-flex align-items-center gap-3">
                <div class="stat-icon"><i class="bi bi-send-check"></i></div>
                <div>
                    <div class="stat-value" data-count="{{ project_stats|sum(attribute='articles_published') }}">0</div>
                    <div class="stat-label">{{ t('published') }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Per-project stats -->
{% if project_stats %}
<div class="animate-in" style="animation-delay: 0.25s;">
    <h5 class="section-header"><i class="bi bi-bar-chart"></i> {{ t('project_overview') }}</h5>
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>{{ t('projects') }}</th>
                    <th>{{ t('keywords') }}</th>
                    <th>{{ t('titles') }}</th>
                    <th>{{ t('articles') }}</th>
                    <th>{{ t('published') }}</th>
                    <th>{{ t('queue') }}</th>
                    <th>{{ t('actions') }}</th>
                </tr>
            </thead>
            <tbody>
            {% for ps in project_stats %}
                <tr>
                    <td><strong>{{ ps.project.name }}</strong></td>
                    <td>{{ ps.keywords }}</td>
                    <td>{{ ps.blog_titles }}</td>
                    <td>{{ ps.articles_total }}</td>
                    <td><span class="badge bg-success">{{ ps.articles_published }}</span></td>
                    <td><span class="badge bg-warning">{{ ps.articles_unpublished }}</span></td>
                    <td>
                        <a href="{{ url_for('content.articles', project_id=ps.project._id) }}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-file-text"></i> {{ t('content') }}
                        </a>
                        <a href="{{ url_for('projects.edit', project_id=ps.project._id) }}" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-gear"></i>
                        </a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="empty-state animate-in">
    <div class="empty-icon"><i class="bi bi-folder-plus"></i></div>
    <p>{{ t('no_projects_yet') }}</p>
    <a href="{{ url_for('projects.create') }}" class="btn btn-primary">{{ t('create_first_project') }}</a>
</div>
{% endif %}

<!-- Active Jobs -->
{% if jobs %}
<div class="animate-in" style="animation-delay: 0.3s;">
    <h5 class="section-header mt-4"><i class="bi bi-clock-history"></i> {{ t('scheduled_jobs') }}</h5>
    <div class="table-responsive">
        <table class="table table-sm">
            <thead><tr><th>{{ t('job_id') }}</th><th>{{ t('next_run') }}</th><th>{{ t('trigger') }}</th></tr></thead>
            <tbody>
            {% for job in jobs %}
            <tr>
                <td><code>{{ job.id }}</code></td>
                <td>{{ job.next_run }}</td>
                <td>{{ job.trigger }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}
